@using Microsoft.Extensions.Options
@using SemanticAgents.Client.Utility
@using SemanticAgents.Configuration

@* <h4>Remote Model</h4> *@

@if (!string.IsNullOrWhiteSpace(_errorMessage))
{
    <p class="text-danger m-2">@_errorMessage</p>
}

<div class="row mt-2">
    <div class="col-2">
        <h5 class="mt-2">Text Model Id:</h5>
    </div>
    <div class="col-3">
        <input inert class="bg-dark text-light form-control" @bind="_textModelId" />
    </div>
    <div class="col-2 offset-1">
        <h5 class="mt-2">Image Model Id:</h5>
    </div>
    <div class="col-3">
        <input inert class="bg-dark text-light form-control" @bind="_imageModelId" />
    </div>
</div>

<hr />

@* @if (!_loadingConfiguration)
{
    <div class="row mt-2">
        <div class="col-12">
            <h6 class="text-info-alt"><i>@_modelInfo</i></h6>
        </div>
    </div>
} *@

@if (_thinking)
{
    <br />
    <div class="mx-auto text-center mb-3 mt-3">
        <div class="spinner-border text-yellow-alt role-status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}

@code {

    [Parameter]
    public string? ConfiguredModelProvider { get; set; }
    [Inject]
    public IOptions<SemanticKernelSettings>? _semanticKernelSettings { get; set; }

    [Parameter]
    public EventCallback<bool> ModelIsLoaded { get; set; }

    private bool _loadingConfiguration;
    private bool _thinking;
    private string? _errorMessage;

    private string? _modelInfo;

    private string? _textModelId;
    private string? _imageModelId;

    // private List<string>? _textModelList;
    // private List<string>? _imageModelList;

    private void UpdateModelInfo() => _modelInfo = $"Text Model: {_textModelId}, Image Model: {_imageModelId}";

    private async Task GetConfiguredProviderDefaults()
    {
        // for OpenAI and Grok - the local model is loaded by the user anyway so a list is not really relevant
        if (ConfiguredModelProvider == "Grok")
        {
            // _textModelList = StaticData.Grok_TextModels;
            // _imageModelList = StaticData.Grok_ImageModels;
            _textModelId = _semanticKernelSettings?.Value.Grok_TextModelId;
            _imageModelId = _semanticKernelSettings?.Value.Grok_ImageModelId;
        }
        else if (ConfiguredModelProvider == "OpenAI")
        {
            // _textModelList = StaticData.OpenAI_TextModels;
            // _imageModelList = StaticData.OpenAI_ImageModels;
            _textModelId = _semanticKernelSettings?.Value.OpenAI_TextModelId;
            _imageModelId = _semanticKernelSettings?.Value.OpenAI_ImageModelId;
        }
        // _textModelId = _textModelList?.FirstOrDefault();
        // _imageModelId = _imageModelList?.FirstOrDefault();

        _modelInfo = $"Text Model: {_textModelId}, Image Model: {_imageModelId}";
        _loadingConfiguration = false;
        _thinking = false;
        @if (!string.IsNullOrWhiteSpace(_textModelId)) await ModelIsLoaded.InvokeAsync(true);
    }

    protected override async Task OnInitializedAsync()
    {
        _loadingConfiguration = true;
        _thinking = true;
        await GetConfiguredProviderDefaults();
        // _chatService = _kernel.GetRequiredService<IChatCompletionService>();
        // if (_kernelInfo is not null) _configuredModelProvider = _kernelInfo.ModelProvider;
    }
}


@* <div class="row mt-2">
@if (_textModelList is not null && _textModelList.Any())
{
        <div class="col-2">
            <h5>Select Text Model:</h5>
        </div>
        <div class="col-3">
            <select class="bg-dark text-light form-select" @bind="_textModelId" @bind:after="UpdateModelInfo">
                @foreach (var model in _textModelList)
                {
                    <option value="@model">@model</option>
                }
            </select>
        </div>
}
    @if (_imageModelList is not null && _imageModelList.Any())
    {
        <div class="col-2 offset-1">
            <h5>Select Image Model:</h5>
        </div>
        <div class="col-3">
            <select class="bg-dark text-light form-select" @bind="_imageModelId" @bind:after="UpdateModelInfo">
                @foreach (var model in _imageModelList)
                {
                    <option value="@model">@model</option>
                }
            </select>
        </div>
    }
</div> *@